# 需求文档

## 介绍

此功能为ParallelLLMProcessor类添加一个恢复方法，能够检测并修复之前运行中未完成或失败的处理结果。该方法将检查现有的SQLite数据库文件，识别结果为空或"NA"的记录，重新处理相应的提示词，并返回完整的结果列表。

## 需求

### 需求1

**用户故事：** 作为使用ParallelLLMProcessor的开发者，我希望能够从中断的处理会话中恢复，以便我可以从中断的地方继续，而不会丢失之前的工作。

#### 验收标准

1. 当我使用数据库文件路径调用恢复方法时，系统应读取现有数据库并识别未完成的结果
2. 当系统在result列中发现空字符串或"NA"值时，系统应提取相应的提示词进行重新处理
3. 当重新处理提示词时，系统应使用当前处理器的配置（chat_fn、num_workers、重试设置）
4. 当重新处理完成时，系统应将新结果更新到数据库的正确位置
5. 当所有处理完成时，系统应按原始顺序返回完整的结果列表

### 需求2

**用户故事：** 作为开发者，我希望恢复方法能够优雅地处理各种失败场景，以便恢复过程稳健可靠。

#### 验收标准

1. 当指定的数据库文件不存在时，系统应抛出清晰的错误消息
2. 当数据库文件存在但没有llm_results表时，系统应抛出清晰的错误消息
3. 当数据库不包含任何记录时，系统应返回空列表
4. 当数据库中的所有结果都已完成时，系统应返回现有结果而不进行重新处理
5. 当数据库读取操作失败时，系统应抛出带有描述性错误消息的适当异常

### 需求3

**用户故事：** 作为开发者，我希望恢复方法能够保持数据完整性，以便现有的成功结果不会丢失或损坏。

#### 验收标准

1. 当更新数据库中的结果时，系统应只修改结果为空或"NA"的记录
2. 当更新结果时，系统应保留原始的提示词和created_at时间戳
3. 当某些记录的数据库更新失败时，系统应继续处理其他记录并报告失败情况
4. 当返回结果时，系统应保持与原始数据库记录完全相同的顺序
5. 当发生并发访问时，系统应适当处理数据库锁定

### 需求4

**用户故事：** 作为开发者，我希望能够看到恢复过程的可见性，以便我可以监控进度并排除故障。

#### 验收标准

1. 当开始恢复时，系统应记录找到的未完成记录数量
2. 当重新处理提示词时，系统应使用进度条显示进度
3. 当更新数据库记录时，系统应记录成功的更新和任何失败情况
4. 当恢复完成时，系统应记录恢复操作的摘要
5. 当发生错误时，系统应提供带有上下文的详细错误消息